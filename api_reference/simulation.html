<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Simulation class &mdash; FBPIC 0.23.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Particles class" href="particles.html" />
    <link rel="prev" title="API reference" href="api_reference.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            FBPIC
          </a>
              <div class="version">
                0.23.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/overview.html">Overview of the code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how_to_run.html">How to run the code</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="api_reference.html">API reference</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">The Simulation class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fbpic.main.Simulation"><code class="docutils literal notranslate"><span class="pre">Simulation</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fbpic.main.Simulation.add_new_species"><code class="docutils literal notranslate"><span class="pre">Simulation.add_new_species()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fbpic.main.Simulation.set_moving_window"><code class="docutils literal notranslate"><span class="pre">Simulation.set_moving_window()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fbpic.main.Simulation.step"><code class="docutils literal notranslate"><span class="pre">Simulation.step()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="particles.html">The Particles class</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostics.html">The openPMD diagnostics</a></li>
<li class="toctree-l2"><a class="reference internal" href="checkpoint_restart.html">Checkpoints and restarts</a></li>
<li class="toctree-l2"><a class="reference internal" href="lpa_utilities/lpa_utilities.html">Laser-plasma utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="boost_converter.html">Conversion to boosted-frame</a></li>
<li class="toctree-l2"><a class="reference internal" href="smoothing.html">Field smoothing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/advanced.html">Advanced use</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">FBPIC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="api_reference.html">API reference</a></li>
      <li class="breadcrumb-item active">The Simulation class</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api_reference/simulation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="the-simulation-class">
<h1>The Simulation class<a class="headerlink" href="#the-simulation-class" title="Permalink to this heading">¶</a></h1>
<p>The <a class="reference internal" href="#fbpic.main.Simulation" title="fbpic.main.Simulation"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Simulation</span></code></a> class is top-level class in FBPIC. It contains all
the simulation data, and has the high-level method <a class="reference internal" href="#fbpic.main.Simulation.step" title="fbpic.main.Simulation.step"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">step</span></code></a>
that performs the PIC cycle.</p>
<p>In addition, its method <a class="reference internal" href="#fbpic.main.Simulation.add_new_species" title="fbpic.main.Simulation.add_new_species"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">add_new_species</span></code></a> allows to create new particle
species, and its method <a class="reference internal" href="#fbpic.main.Simulation.set_moving_window" title="fbpic.main.Simulation.set_moving_window"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">set_moving_window</span></code></a> activates the moving window.</p>
<dl class="py class">
<dt class="sig sig-object py" id="fbpic.main.Simulation">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">fbpic.main.</span></span><span class="sig-name descname"><span class="pre">Simulation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Nz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zmax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Nr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rmax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Nm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_zmin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-inf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_zmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">inf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_rmin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_rmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">inf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_nz</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_nr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_nt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_e</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zmin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dens_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_currents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v_comoving</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_galilean</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initialize_ions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_cuda</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_guard</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_damp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'r':</span> <span class="pre">32,</span> <span class="pre">'z':</span> <span class="pre">64}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exchange_period</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current_correction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'curl-free'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">boundaries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'r':</span> <span class="pre">'reflective',</span> <span class="pre">'z':</span> <span class="pre">'periodic'}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma_boost</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_all_mpi_ranks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">particle_shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'linear'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smoother</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_ruyten_shapes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_modified_volume</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/fbpic/main.html#Simulation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#fbpic.main.Simulation" title="Permalink to this definition">¶</a></dt>
<dd><p>Initializes a simulation.</p>
<p>By default, this will not create any particle species. You can
then add particles species to the simulation by using e.g. the method
<code class="docutils literal notranslate"><span class="pre">add_new_species</span></code> of the simulation object.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As a short-cut, you can also directly create particle
species when initializing the <code class="docutils literal notranslate"><span class="pre">Simulation</span></code> object,
by passing the aguments <cite>n_e</cite>, <cite>p_rmin</cite>, <cite>p_rmax</cite>, <cite>p_nz</cite>,
<cite>p_nr</cite>, <cite>p_nt</cite>, and <cite>dens_func</cite>. This will create:</p>
<blockquote>
<div><ul class="simple">
<li><p>an electron species</p></li>
<li><p>(if <code class="docutils literal notranslate"><span class="pre">initialize_ions</span></code> is True) an ion species (Hydrogen 1+)</p></li>
</ul>
</div></blockquote>
<p>See the docstring of the method <code class="docutils literal notranslate"><span class="pre">add_new_species</span></code> for the
above-mentioned arguments (where <cite>n_e</cite> has been re-labeled as <cite>n</cite>).</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Nz</strong> (<em>int</em>) – The number of gridpoints along z</p></li>
<li><p><strong>Nr</strong> (<em>int</em>) – The number of gridpoints along r</p></li>
<li><p><strong>zmax</strong> (<em>float</em>) – The position of the edge of the simulation in z
(More precisely, the position of the edge of the last cell)</p></li>
<li><p><strong>rmax</strong> (<em>float</em>) – The position of the edge of the simulation in r
(More precisely, the position of the edge of the last
cell)</p></li>
<li><p><strong>Nm</strong> (<em>int</em>) – The number of azimuthal modes taken into account. (The simulation
uses the modes from <cite>m=0</cite> to <cite>m=(Nm-1)</cite>.)</p></li>
<li><p><strong>dt</strong> (<em>float</em>) – The timestep of the simulation</p></li>
<li><p><strong>n_order</strong> (<em>int</em><em>, </em><em>optional</em>) – The order of the stencil for z derivatives in the Maxwell solver.
Use -1 for infinite order, i.e. for exact dispersion relation in
all direction (adviced for single-GPU/single-CPU simulation).
Use a positive number (and multiple of 2) for a finite-order stencil
(required for multi-GPU/multi-CPU with MPI). A large <cite>n_order</cite> leads
to more overhead in MPI communications, but also to a more accurate
dispersion relation for electromagnetic waves. (Typically,
<cite>n_order = 32</cite> is a good trade-off.) See <a class="reference external" href="https://arxiv.org/abs/1611.05712">this article</a> for more information.</p></li>
<li><p><strong>zmin</strong> (<em>float</em><em>, </em><em>optional</em>) – The position of the edge of the simulation box.
(More precisely, the position of the edge of the first cell)</p></li>
<li><p><strong>initialize_ions</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to initialize the neutralizing ions</p></li>
<li><p><strong>filter_currents</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to filter the currents and charge in k space</p></li>
<li><p><strong>v_comoving</strong> (<em>float</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – If this variable is None, the standard PSATD is used (default).
Otherwise, the current is assumed to be “comoving”,
i.e. constant with respect to (z - v_comoving * t).
This can be done in two ways: either by
- Using a PSATD scheme that takes this hypothesis into account
- Solving the PSATD scheme in a Galilean frame</p></li>
<li><p><strong>use_galilean</strong> (<em>bool</em><em>, </em><em>optional</em>) – Determines which one of the two above schemes is used
When use_galilean is true, the whole grid moves
with a speed v_comoving</p></li>
<li><p><strong>use_cuda</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to use CUDA (GPU) acceleration</p></li>
<li><p><strong>n_guard</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of guard cells to use at the left and right of
a domain, when performing parallel (MPI) computation
or when using open boundaries. Defaults to None, which
calculates the required guard cells for n_order
automatically (approx 2*n_order). If no MPI is used and
in the case of open boundaries with an infinite order stencil,
n_guard defaults to 64, if not set otherwise.</p></li>
<li><p><strong>n_damp</strong> (<em>dict</em><em>, </em><em>optional</em>) – A dictionary with ‘z’ and ‘r’ as keys, and integers as values.
The integers represent the number of damping cells in the
longitudinal (z) and transverse (r) directions, respectively.
The damping cells in z are only used if <cite>boundaries[‘z’]</cite> is
<cite>‘open’</cite>, and are added at the left and right edge of the
simulation domain. The damping cells in r are used only if
<cite>boundaries[‘r’]</cite> is <cite>‘open’</cite>, and are added at upper
radial boundary (at <cite>rmax</cite>).</p></li>
<li><p><strong>exchange_period</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of iterations before which the particles are exchanged.
If set to None, the maximum exchange period is calculated
automatically: Within exchange_period timesteps, the
particles should never be able to travel more than
(n_guard/2 - particle_shape order) cells. (Setting exchange_period
to small values can substantially affect the performance)</p></li>
<li><p><strong>boundaries</strong> (<em>dict</em><em>, </em><em>optional</em>) – <p>A dictionary with ‘z’ and ‘r’ as keys, and strings as values.
This specifies the field boundary in the longitudinal (z) and
transverse (r) direction respectively:</p>
<blockquote>
<div><ul>
<li><p><cite>boundaries[‘z’]</cite> can be either <cite>‘periodic’</cite> or <cite>‘open’</cite>
(for field-absorbing boundary).</p></li>
<li><p><cite>boundaries[‘r’]</cite> can be either <cite>‘reflective’</cite> or <cite>‘open’</cite>
(for field-absorbing boundary). For <cite>‘open’</cite>, this adds
Perfectly-Matched-Layers in the radial direction ; note that
the computation is significantly more costly in this case.</p></li>
</ul>
</div></blockquote>
</p></li>
<li><p><strong>current_correction</strong> (<em>string</em><em>, </em><em>optional</em>) – The method used in order to ensure that the continuity equation
is satisfied. Either <cite>curl-free</cite> or <cite>cross-deposition</cite>.
<cite>curl-free</cite> is faster but less local.</p></li>
<li><p><strong>gamma_boost</strong> (<em>float</em><em>, </em><em>optional</em>) – When running the simulation in a boosted frame, set the
value of <cite>gamma_boost</cite> to the corresponding Lorentz factor.
All the other quantities (zmin, zmax, n_e, etc.) are to be given
in the lab frame.</p></li>
<li><p><strong>use_all_mpi_ranks</strong> (<em>bool</em><em>, </em><em>optional</em>) – <p>When launching the simulation with mpirun:</p>
<ul>
<li><p>if <cite>use_all_mpi_ranks</cite> is True (default):
All the MPI ranks will contribute to the same simulation,
using domain-decomposition to share the work.</p></li>
<li><p>if <cite>use_all_mpi_ranks</cite> is False:
Each MPI rank will run an independent simulation.
This can be useful when running parameter scans. In this case,
make sure that your input script is written so that the input
parameters and output folder depend on the MPI rank.</p></li>
</ul>
</p></li>
<li><p><strong>particle_shape</strong> (<em>str</em><em>, </em><em>optional</em>) – Set the particle shape for the charge/current deposition.
Possible values are ‘cubic’, ‘linear’. (‘cubic’ corresponds to
third order shapes and ‘linear’ to first order shapes).</p></li>
<li><p><strong>verbose_level</strong> (<em>int</em><em>, </em><em>optional</em>) – Print information about the simulation setup after
initialization of the Simulation class.
0 - Print no information
1 (Default) - Print basic information
2 - Print detailed information</p></li>
<li><p><strong>smoother</strong> (an instance of <a class="reference internal" href="smoothing.html#fbpic.fields.smoothing.BinomialSmoother" title="fbpic.fields.smoothing.BinomialSmoother"><code class="xref any py py-class docutils literal notranslate"><span class="pre">BinomialSmoother</span></code></a>, optional) – Determines how the charge and currents are smoothed.
(Default: one-pass binomial filter and no compensator.)</p></li>
<li><p><strong>use_ruyten_shapes</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to use Ruyten shape factors for the particle deposition.
(Ruyten JCP 105 (1993) <a class="reference external" href="https://doi.org/10.1006/jcph.1993.1070">https://doi.org/10.1006/jcph.1993.1070</a>)
This ensures that a uniform distribution of macroparticles
leads to a uniform charge density deposited on the grid,
even close to the axis (in the limit of many particles in r).</p></li>
<li><p><strong>use_modified_volume</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to use a slightly-modified, effective cell volume, that
ensures that the charge deposited near the axis is correctly
taken into account by the spectral cylindrical Maxwell solver.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="fbpic.main.Simulation.add_new_species">
<span class="sig-name descname"><span class="pre">add_new_species</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">q</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dens_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_nz</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_nr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_nt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_zmin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-inf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_zmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">inf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_rmin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_rmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">inf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uz_m</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ux_m</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uy_m</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uz_th</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ux_th</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uy_th</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">continuous_injection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">boost_positions_in_dens_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_tracer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/fbpic/main.html#Simulation.add_new_species"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#fbpic.main.Simulation.add_new_species" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a new species (i.e. an instance of <cite>Particles</cite>) with
charge <cite>q</cite> and mass <cite>m</cite>. Add it to the simulation (i.e. to the list
<cite>Simulation.ptcl</cite>), and return it, so that the methods of the
<cite>Particles</cite> class can be used, for this particular species.</p>
<p>In addition, if <cite>n</cite> is set, then new macroparticles will be created
within this species (in an evenly-spaced manner).</p>
<p>For boosted-frame simulations (i.e. where <cite>gamma_boost</cite>
as been passed to the <cite>Simulation</cite> object), all quantities that
are explicitly mentioned to be in the lab frame below are
automatically converted to the boosted frame.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For the arguments below, it is recommended to have at least
<code class="docutils literal notranslate"><span class="pre">p_nt</span> <span class="pre">=</span> <span class="pre">4*Nm</span></code> (except in the case <code class="docutils literal notranslate"><span class="pre">Nm=1</span></code>, for which
<code class="docutils literal notranslate"><span class="pre">p_nt=1</span></code> is sufficient). In other words, the required number of
macroparticles along <cite>theta</cite> (in order for the simulation to be
properly resolved) increases with the number of azimuthal modes used.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>q</strong> (<em>float</em><em> (</em><em>in Coulombs</em><em>)</em>) – Charge of the particle species</p></li>
<li><p><strong>m</strong> (<em>float</em><em> (</em><em>in kg</em><em>)</em>) – Mass of the particle species</p></li>
<li><p><strong>n</strong> (float (in particles per m^3) or <cite>None</cite>, optional) – Density of physical particles (in the lab frame).
If this is <cite>None</cite>, no macroparticles will be created.
If <cite>n</cite> is not None, evenly-spaced macroparticles will be generated.</p></li>
<li><p><strong>dens_func</strong> (<em>callable</em><em>, </em><em>optional</em>) – <p>A function of the form <cite>dens_func( z, r )</cite>
where <cite>z</cite> and <cite>r</cite> are 1d arrays, or <cite>dens( x, y, z)</cite>
where <cite>x</cite>, <cite>y</cite> and <cite>z</cite> are 1d arrays, and which returns
a 1d array containing the density <em>relative to `n`</em>
(i.e. a number between 0 and 1) at the given positions</p>
<p>For boosted-frame simulation: if you set
<code class="docutils literal notranslate"><span class="pre">boost_positions_in_dens_func</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>, then <code class="docutils literal notranslate"><span class="pre">dens_func</span></code>
can be expressed as a function of <code class="docutils literal notranslate"><span class="pre">z</span></code> taken <strong>in the lab frame</strong>.
Otherwise, it has to be expressed as a function of <code class="docutils literal notranslate"><span class="pre">z</span></code> taken
in the boosted frame.</p>
</p></li>
<li><p><strong>p_nz</strong> (<em>int</em><em>, </em><em>optional</em>) – The number of macroparticles per cell along the z direction</p></li>
<li><p><strong>p_nr</strong> (<em>int</em><em>, </em><em>optional</em>) – The number of macroparticles per cell along the r direction</p></li>
<li><p><strong>p_nt</strong> (<em>int</em><em>, </em><em>optional</em>) – The number of macroparticles along the theta direction</p></li>
<li><p><strong>p_zmin</strong> (<em>float</em><em> (</em><em>in meters</em><em>)</em><em>, </em><em>optional</em>) – The minimal z position above which the particles are initialized
(in the lab frame). Default: left edge of the simulation box.</p></li>
<li><p><strong>p_zmax</strong> (<em>float</em><em> (</em><em>in meters</em><em>)</em><em>, </em><em>optional</em>) – The maximal z position below which the particles are initialized
(in the lab frame). Default: right edge of the simulation box.</p></li>
<li><p><strong>p_rmin</strong> (<em>float</em><em> (</em><em>in meters</em><em>)</em><em>, </em><em>optional</em>) – The minimal r position above which the particles are initialized
(in the lab frame). Default: 0</p></li>
<li><p><strong>p_rmax</strong> (<em>floats</em><em> (</em><em>in meters</em><em>)</em><em>, </em><em>optional</em>) – The maximal r position below which the particles are initialized
(in the lab frame). Default: upper edge of the simulation box.</p></li>
<li><p><strong>uz_m</strong> (<em>floats</em><em> (</em><em>dimensionless</em><em>)</em><em>, </em><em>optional</em>) – Normalized mean momenta (in the lab frame)
of the injected particles in each direction</p></li>
<li><p><strong>ux_m</strong> (<em>floats</em><em> (</em><em>dimensionless</em><em>)</em><em>, </em><em>optional</em>) – Normalized mean momenta (in the lab frame)
of the injected particles in each direction</p></li>
<li><p><strong>uy_m</strong> (<em>floats</em><em> (</em><em>dimensionless</em><em>)</em><em>, </em><em>optional</em>) – Normalized mean momenta (in the lab frame)
of the injected particles in each direction</p></li>
<li><p><strong>uz_th</strong> (<em>floats</em><em> (</em><em>dimensionless</em><em>)</em><em>, </em><em>optional</em>) – Normalized thermal momenta (in the lab frame)
in each direction</p></li>
<li><p><strong>ux_th</strong> (<em>floats</em><em> (</em><em>dimensionless</em><em>)</em><em>, </em><em>optional</em>) – Normalized thermal momenta (in the lab frame)
in each direction</p></li>
<li><p><strong>uy_th</strong> (<em>floats</em><em> (</em><em>dimensionless</em><em>)</em><em>, </em><em>optional</em>) – Normalized thermal momenta (in the lab frame)
in each direction</p></li>
<li><p><strong>continuous_injection</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to continuously inject the particles,
in the case of a moving window</p></li>
<li><p><strong>boost_positions_in_dens_func</strong> (<em>bool</em><em>, </em><em>optional</em>) – For boosted-frame simulations: whether to automatically take into
account the Lorentz transformation of the positions, in <cite>dens_func</cite></p></li>
<li><p><strong>is_tracer</strong> (<em>bool</em><em>, </em><em>optional</em>) – Setting this flag to True will allow this particle
to move as a normal particle with given mass and charge,
but will generate no current. This allows them to be passive
tracers inside the plasma.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>new_species</strong></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>an instance of the <cite>Particles</cite> class</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fbpic.main.Simulation.set_moving_window">
<span class="sig-name descname"><span class="pre">set_moving_window</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">v</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">299792458.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ux_m</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uy_m</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uz_m</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ux_th</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uy_th</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uz_th</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma_boost</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/fbpic/main.html#Simulation.set_moving_window"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#fbpic.main.Simulation.set_moving_window" title="Permalink to this definition">¶</a></dt>
<dd><p>Initializes a moving window for the simulation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>v</strong> (<em>float</em><em> (</em><em>in meters per seconds</em><em>)</em><em>, </em><em>optional</em>) – The speed of the moving window</p></li>
<li><p><strong>ux_m</strong> (<em>float</em><em> (</em><em>dimensionless</em><em>)</em><em>, </em><em>optional</em>) – Unused, kept for backward-compatibility</p></li>
<li><p><strong>uy_m</strong> (<em>float</em><em> (</em><em>dimensionless</em><em>)</em><em>, </em><em>optional</em>) – Unused, kept for backward-compatibility</p></li>
<li><p><strong>uz_m</strong> (<em>float</em><em> (</em><em>dimensionless</em><em>)</em><em>, </em><em>optional</em>) – Unused, kept for backward-compatibility</p></li>
<li><p><strong>ux_th</strong> (<em>float</em><em> (</em><em>dimensionless</em><em>)</em><em>, </em><em>optional</em>) – Unused, kept for backward-compatibility</p></li>
<li><p><strong>uy_th</strong> (<em>float</em><em> (</em><em>dimensionless</em><em>)</em><em>, </em><em>optional</em>) – Unused, kept for backward-compatibility</p></li>
<li><p><strong>uz_th</strong> (<em>float</em><em> (</em><em>dimensionless</em><em>)</em><em>, </em><em>optional</em>) – Unused, kept for backward-compatibility</p></li>
<li><p><strong>gamma_boost</strong> (<em>float</em><em>, </em><em>optional</em>) – Unused; kept for backward compatibility</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fbpic.main.Simulation.step">
<span class="sig-name descname"><span class="pre">step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">N</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correct_currents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correct_divE</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_true_rho</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">move_positions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">move_momenta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_progress</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/fbpic/main.html#Simulation.step"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#fbpic.main.Simulation.step" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform N PIC cycles.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>N</strong> (<em>int</em><em>, </em><em>optional</em>) – The number of timesteps to take
Default: N=1</p></li>
<li><p><strong>correct_currents</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to correct the currents in spectral space</p></li>
<li><p><strong>correct_divE</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to correct the divergence of E in spectral space</p></li>
<li><p><strong>use_true_rho</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to use the true rho deposited on the grid for the
field push or not. (requires initialize_ions = True)</p></li>
<li><p><strong>move_positions</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to move or freeze the particles’ positions</p></li>
<li><p><strong>move_momenta</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to move or freeze the particles’ momenta</p></li>
<li><p><strong>show_progress</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to show a progression bar</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="api_reference.html" class="btn btn-neutral float-left" title="API reference" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="particles.html" class="btn btn-neutral float-right" title="The Particles class" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016, FBPIC contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>